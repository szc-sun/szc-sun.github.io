---
layout: post
title: 'wangEditor å¯Œæ–‡æœ¬ç¼–è¾‘å™¨çš„ä½¿ç”¨'
subtitle: 'wangEditor å¯Œæ–‡æœ¬ç¼–è¾‘å™¨çš„ä½¿ç”¨'
date: 2021-04-06
categories: æŠ€æœ¯
cover: ''
tags: å‰ç«¯å¼€å‘
---

### å†™åœ¨å‰é¢
å¼€æºçš„å¯Œæ–‡æœ¬ wangEditor å»å¹´æœ‰äº†å›¢é˜Ÿäº†ï¼Œçœ‹äº†ä»–ä»¬çš„æ–‡ç« æœ‰äº†å›¢é˜Ÿã€QQç¾¤ã€ä¸­æ–‡apiï¼Œç”¨ç€åº”è¯¥ä¸é”™ã€‚

[wangEditor V4.0 æ¢ç´¢ä»¥å›¢é˜Ÿçš„å½¢å¼åšå¼€æºé¡¹ç›®](https://juejin.cn/post/6882522512861691912 "wangEditor V4.0 æ¢ç´¢ä»¥å›¢é˜Ÿçš„å½¢å¼åšå¼€æºé¡¹ç›®")
[wangEditor-v4----å®˜ç½‘](https://www.wangeditor.com/ "wangEditor-v4----å®˜ç½‘")
[wangEditor-v4----apiæ–‡æ¡£](https://doc.wangeditor.com/ "wangEditor-v4----apiæ–‡æ¡£")

### æµè§ˆå™¨å…¼å®¹æ€§
å…¼å®¹ä¸»æµ PC æµè§ˆå™¨ï¼ŒIE11+
ä¸æ”¯æŒç§»åŠ¨ç«¯å’Œ ipad

### ç®€å•è¯´ä¸‹ä½¿ç”¨æ–¹æ³•

#### 1ã€å¼•å…¥æ–¹æ³•ä¸€ï¼šNPM
npm å®‰è£… `npm i wangeditor --save` ï¼Œå‡ è¡Œä»£ç å³å¯åˆ›å»ºä¸€ä¸ªç¼–è¾‘å™¨ã€‚
```javascript
import E from 'wangeditor'
const editor = new E('#div1')
editor.create()
```
#### 2ã€å¼•å…¥æ–¹æ³•äºŒï¼šCDN
```javascript
<script
  type="text/javascript"
  src="https://cdn.jsdelivr.net/npm/wangeditor@latest/dist/wangEditor.min.js"
></script>
<script type="text/javascript">
  const E = window.wangEditor
  const editor = new E("#div1")
  // æˆ–è€… const editor = new E(document.getElementById('div1'))
  editor.create()
</script>
```

### vueä¸­ä½¿ç”¨--å°è£…æˆç»„ä»¶
#### 1ã€ç»„ä»¶ src\components\wangEditor\index.vue
```javascript
<template lang="html">
    <div id="div1" ref="div1">
        <p>æ¬¢è¿ä½¿ç”¨ <b>wangEditorvue</b> å¯Œæ–‡æœ¬ç¼–è¾‘å™¨</p>
    </div>
</template>
<script>
  import E from 'wangeditor'
  import uploadImg from '@/api/uploadImg'
  export default {
    name: 'wangEditor',
    data() {
      return {
        editor: null,
        info_: null
      }
    },
    model: {
      prop: 'value',
      event: 'change'
    },
    props: {
      value: {
        type: String,
        default: ''
      },
      isClear: {
        type: Boolean,
        default: false
      },
      config:{
        type: Object,
        default: ()=>{}
      }
    },
    watch: {
      isClear(val) {
        // è§¦å‘æ¸…é™¤æ–‡æœ¬åŸŸå†…å®¹
        if (val) {
          this.editor.txt.clear()
          this.info_ = null
        }
      },
      value: function(value) {
        if (value !== this.editor.txt.html()) {
          this.editor.txt.html(this.value)
        }
      }
      //valueä¸ºç¼–è¾‘æ¡†è¾“å…¥çš„å†…å®¹ï¼Œè¿™é‡Œç›‘å¬äº†ä¸€ä¸‹å€¼ï¼Œå½“çˆ¶ç»„ä»¶è°ƒç”¨å¾—æ—¶å€™ï¼Œå¦‚æœç»™valueèµ‹å€¼äº†ï¼Œå­ç»„ä»¶å°†ä¼šæ˜¾ç¤ºçˆ¶ç»„ä»¶èµ‹ç»™çš„å€¼
    },
    mounted() {
		// åˆ›å»ºæ ‡ç­¾
		this.seteditor()
		// é‡æ–°è®¾ç½®ç¼–è¾‘å™¨å†…å®¹
		this.editor.txt.html(this.value)
    },
	beforeDestroy() {
		// è°ƒç”¨é”€æ¯ API å¯¹å½“å‰ç¼–è¾‘å™¨å®ä¾‹è¿›è¡Œé”€æ¯
		this.editor.destroy()
		this.editor = null
	},
    methods: {
      seteditor() {
        this.editor = new E(this.$refs.div1)
        // é…ç½®èœå•æ ï¼Œåˆ å‡èœå•ï¼Œè°ƒæ•´é¡ºåº
        this.editor.config.menus = [
          'head', // æ ‡é¢˜
          'bold', // ç²—ä½“
          'fontSize', // å­—å·
          'fontName', // å­—ä½“
          'italic', // æ–œä½“
          'underline', // ä¸‹åˆ’çº¿
          'strikeThrough', // åˆ é™¤çº¿
          'foreColor', // æ–‡å­—é¢œè‰²
          'backColor', // èƒŒæ™¯é¢œè‰²
          'link', // æ’å…¥é“¾æ¥
          'list', // åˆ—è¡¨
          'justify', // å¯¹é½æ–¹å¼
          'quote', // å¼•ç”¨
          'emoticon', // è¡¨æƒ…
          'image', // æ’å…¥å›¾ç‰‡
          'table', // è¡¨æ ¼
          // 'video', // æ’å…¥è§†é¢‘
          'code', // æ’å…¥ä»£ç 
          'undo', // æ’¤é”€
          'redo', // é‡å¤
          'fullscreen' // å…¨å±
        ]
        // è‡ªå·±å®ç°ä¸Šä¼ å›¾ç‰‡
        this.editor.config.customUploadImg = (resultFiles, insertImgFn) => {
          // resultFiles æ˜¯ input ä¸­é€‰ä¸­çš„æ–‡ä»¶åˆ—è¡¨
          // insertImgFn æ˜¯è·å–å›¾ç‰‡ url åï¼Œæ’å…¥åˆ°ç¼–è¾‘å™¨çš„æ–¹æ³•

          // ä¸Šä¼ å›¾ç‰‡ï¼Œè¿”å›ç»“æœï¼Œå°†å›¾ç‰‡æ’å…¥åˆ°ç¼–è¾‘å™¨ä¸­
          for( let i = 0, len = resultFiles.length; i < len; i++){
            this.requestUpload(resultFiles[i], insertImgFn)
          }
        }
        this.editor.config.onchange = (newHtml) => {
          this.info_ = newHtml // ç»‘å®šå½“å‰é€æ¸åœ°å€¼
          this.$emit('change', this.info_) // å°†å†…å®¹åŒæ­¥åˆ°çˆ¶ç»„ä»¶ä¸­
        }
        Object.assign(this.editor.config, this.config)
        // åˆ›å»ºå¯Œæ–‡æœ¬ç¼–è¾‘å™¨
        this.editor.create()
      },
      // è‡ªå®šä¹‰ä¸Šä¼ 
      async requestUpload(file, insertImgFn){
		var formData = new FormData();
		formData.append("file", file);
        try {
          	let res = await uploadImg(formData)
			if (res.code === 200) {;
				// ä¸Šä¼ å›¾ç‰‡ï¼Œè¿”å›ç»“æœï¼Œå°†å›¾ç‰‡æ’å…¥åˆ°ç¼–è¾‘å™¨ä¸­
				insertImgFn(res.data.url)
			}
        } catch (error) {}
      }
    }
  }
</script>
<style lang="css">
  .editor {
    width: 100%;
    margin: 0 auto;
    position: relative;
    z-index: 0;
  }
  .toolbar {
    border: 1px solid #ccc;
  }
  .text {
    border: 1px solid #ccc;
    min-height: 500px;
  }
</style>
```
#### 2ã€è°ƒç”¨
```javascript
<template>
  <div>
    <wangEditor v-model="content" :isClear="false"></wangEditor>
  </div>
</template>

<script>
import wangEditor from '@/components/wangEditor'
export default {
  components: { wangEditor },
  data () {
    return {
      content: 'ğŸ˜„'
    }
  }
}
</script>

<style>

</style>
```

![wangEditor](https://upload-images.jianshu.io/upload_images/12200279-cb01595ec26b540a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 "wangEditor")

#### 3ã€è¯´æ˜ ï¼š
> editor.config.customUploadImgç›´æ¥é‡å†™äº†ä¸Šä¼ äº‹ä»¶ï¼Œè‡ªå·±å®ç°ä¸Šä¼ å›¾ç‰‡ï¼Œé€‚åº”æ¯”è¾ƒå¤æ‚çš„ä¸Šä¼ æƒ…å†µï¼Œä¾‹å¦‚å¤šä¸ªæ¥å£å¼‚æ­¥é—®é¢˜ã€‚ç®€å•çš„æ¥å£è°ƒç”¨æ—¶é…ç½®ä¸‹ä¸Šä¼ å‚æ•°å°±å¯ä»¥äº†

```javascript
// é…ç½® server æ¥å£åœ°å€
editor.config.uploadImgServer = '/upload-img'

// é»˜è®¤é™åˆ¶å›¾ç‰‡å¤§å°æ˜¯ 5M ï¼Œå¯ä»¥è‡ªå·±ä¿®æ”¹ã€‚
editor.config.uploadImgMaxSize = 2 * 1024 * 1024 // 2M

// é™åˆ¶ç±»å‹
editor.config.uploadImgAccept = ['jpg', 'jpeg', 'png', 'gif', 'bmp']

// é»˜è®¤ä¸º 100 å¼ ï¼Œéœ€è¦é™åˆ¶å¯è‡ªå·±é…ç½®ã€‚
editor.config.uploadImgMaxLength = 5 // ä¸€æ¬¡æœ€å¤šä¸Šä¼  5 ä¸ªå›¾ç‰‡

// è‡ªå®šä¹‰ä¸Šä¼ å‚æ•°
editor.config.uploadImgParams = {
    token: 'xxxxx',
    x: 100
}

// å¦‚æœéœ€è¦å°†å‚æ•°æ‹¼æ¥åˆ° url ä¸­ï¼Œå¯å†åŠ ä¸Šå¦‚ä¸‹é…ç½®ã€‚
editor.config.uploadImgParamsWithUrl = true

// å¯è‡ªå®šä¹‰ filename
editor.config.uploadFileName = 'your-custom-fileName'
// ä¸Šä¼ å›¾ç‰‡æ—¶æ·»åŠ  http è¯·æ±‚çš„ header ã€‚
editor.config.uploadImgHeaders = {
    Accept: 'text/x-json',
    a: 100,
}

//è·¨åŸŸä¸Šä¼ ä¸­å¦‚æœéœ€è¦ä¼ é€’ cookie éœ€è®¾ç½® withCredentials ã€‚
editor.config.withCredentials = true

// timeout å³ä¸Šä¼ æ¥å£ç­‰å¾…çš„æœ€å¤§æ—¶é—´ï¼Œé»˜è®¤æ˜¯ 10 ç§’é’Ÿï¼Œå¯ä»¥è‡ªå·±ä¿®æ”¹ã€‚
editor.config.uploadImgTimeout = 5 * 1000

//å›è°ƒå‡½æ•°
editor.config.uploadImgHooks = {
    // ä¸Šä¼ å›¾ç‰‡ä¹‹å‰
    before: function(xhr) {
        console.log(xhr)

        // å¯é˜»æ­¢å›¾ç‰‡ä¸Šä¼ 
        return {
            prevent: true,
            msg: 'éœ€è¦æç¤ºç»™ç”¨æˆ·çš„é”™è¯¯ä¿¡æ¯'
        }
    },
    // å›¾ç‰‡ä¸Šä¼ å¹¶è¿”å›äº†ç»“æœï¼Œå›¾ç‰‡æ’å…¥å·²æˆåŠŸ
    success: function(xhr) {
        console.log('success', xhr)
    },
    // å›¾ç‰‡ä¸Šä¼ å¹¶è¿”å›äº†ç»“æœï¼Œä½†å›¾ç‰‡æ’å…¥æ—¶å‡ºé”™äº†
    fail: function(xhr, editor, resData) {
        console.log('fail', resData)
    },
    // ä¸Šä¼ å›¾ç‰‡å‡ºé”™ï¼Œä¸€èˆ¬ä¸º http è¯·æ±‚çš„é”™è¯¯
    error: function(xhr, editor, resData) {
        console.log('error', xhr, resData)
    },
    // ä¸Šä¼ å›¾ç‰‡è¶…æ—¶
    timeout: function(xhr) {
        console.log('timeout')
    },
    // å›¾ç‰‡ä¸Šä¼ å¹¶è¿”å›äº†ç»“æœï¼Œæƒ³è¦è‡ªå·±æŠŠå›¾ç‰‡æ’å…¥åˆ°ç¼–è¾‘å™¨ä¸­
    // ä¾‹å¦‚æœåŠ¡å™¨ç«¯è¿”å›çš„ä¸æ˜¯ { errno: 0, data: [...] } è¿™ç§æ ¼å¼ï¼Œå¯ä½¿ç”¨ customInsert
    customInsert: function(insertImgFn, result) {
        // result å³æœåŠ¡ç«¯è¿”å›çš„æ¥å£
        console.log('customInsert', result)

        // insertImgFn å¯æŠŠå›¾ç‰‡æ’å…¥åˆ°ç¼–è¾‘å™¨ï¼Œä¼ å…¥å›¾ç‰‡ src ï¼Œæ‰§è¡Œå‡½æ•°å³å¯
        insertImgFn(result.data[0])
    }
}

```

### å…¶ä»–

æ›´å¤šé…ç½®ï¼ŒæŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œå†™çš„å¾ˆè¯¦ç»†ã€‚ [wangEditor-v4----apiæ–‡æ¡£](https://doc.wangeditor.com/ "wangEditor-v4----apiæ–‡æ¡£")

### äº¤æµ
##### åŠ å…¥ QQ ç¾¤
- 164999061
- 710646022ï¼ˆäººå·²æ»¡ï¼‰
- 901247714ï¼ˆäººå·²æ»¡ï¼‰

##### æäº¤ bug æˆ–å»ºè®®
[github issues æäº¤é—®é¢˜](https://github.com/wangeditor-team/wangeditor/issues "github issues æäº¤é—®é¢˜")




